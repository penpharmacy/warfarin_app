<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ Warfarin ‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏û‡∏∏‡∏ô‡∏û‡∏¥‡∏ô</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
/* --- COPY PROTECTION STYLES (‡πÄ‡∏î‡∏¥‡∏°) --- */
body {
    user-select: none; /* Standard syntax */
    -webkit-user-select: none; /* Safari */
    -moz-user-select: none; /* Firefox */
    -ms-user-select: none; /* IE/Edge */
    background:linear-gradient(180deg,var(--bg),#FFFFFF);
    margin:0;
    padding:20px;
    color:#263238;
}
/* ------------------------------- */

:root{
    --bg:#F0F8FF; 
    --card:#FFFFFF;
    --accent:#00A896;
    --accent-light:#CCEEEA;
    --muted:#5A6A70;
    --highlight:#75C2B9;

    --plan-bg-1: #F8FFFF;
    --plan-bg-2: #FFFBF8;
    --plan-bg-3: #FAF8FF;
    --plan-border-1: #40B2D6;
    --plan-border-2: #FFAD60;
    --plan-border-3: #AA8CFF;

    --main-pink: #E91E63;
    --light-pink: #FDE8F1;
    --accent-green: #4CAF50;
    font-family: 'Kanit', sans-serif;
}
body::before{
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ logo1.gif ‡πÉ‡∏ô path ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á */
    background: url('logo1.gif') center center no-repeat; 
    background-size: 380px auto;
    opacity: 0.06;
    z-index: -1;
}
header{display:flex;align-items:center;gap:12px}
h1{margin:0;font-size:20px;text-align:center;flex:1;color:var(--accent)}
.container{max-width:980px;margin:20px auto}
.card{background:var(--card);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,0.08);padding:18px;margin-bottom:16px;border-top:4px solid var(--highlight)}
label{display:block;font-size:14px;margin-bottom:6px;color:var(--muted)}
input[type=number]{width:100%;padding:10px;border-radius:10px;border:1px solid #cfd8dc;font-size:16px;background:#FAFAFA;}
.row{display:flex;gap:12px}
.col{flex:1}
.radio-row{display:flex;gap:10px;flex-wrap:wrap}
.pill{padding:8px 14px;border-radius:20px;border:1px solid #B2DFDB;background:#E0F2F1;cursor:pointer;transition:all 0.2s ease}
.pill:hover{background:var(--highlight);color:#004D40}
button.primary{background:var(--accent);color:#fff;border:0;padding:12px 20px;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.2s ease}
button.primary:hover{background:#008F85}
.result{margin-top:12px}
table{width:100%;border-collapse:collapse;border-radius:10px;overflow:hidden; table-layout: fixed; }
th,td{padding:8px;border-bottom:1px solid #E0F2F1;text-align:center; font-size: 14px;}
th{background:var(--accent-light);color:#004D40}
.plan-table tbody tr:nth-child(odd) { background-color: #F8F8F8; }
.plan-table.plan-1 tbody tr:nth-child(odd) { background-color: #F9FFFF; }
.plan-table.plan-2 tbody tr:nth-child(odd) { background-color: #FFFFF9; }
.plan-table.plan-3 tbody tr:nth-child(odd) { background-color: #FCFAFF; }
.small{font-size:13px;color:var(--muted)}
.note{background:var(--accent-light);padding:10px;border-radius:10px;margin-top:8px;white-space:pre-line;color:#004D40}
footer{font-size:13px;color:var(--muted);text-align:center;padding:8px}
@media(max-width:720px){.row{flex-direction:column}}
.plan-section { padding: 15px; margin-top: 15px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow-x: auto;}
.plan-section.plan-1 { background-color: var(--plan-bg-1); border-left: 5px solid var(--plan-border-1);}
.plan-section.plan-2 { background-color: var(--plan-bg-2); border-left: 5px solid var(--plan-border-2);}
.plan-section.plan-3 { background-color: var(--plan-bg-3); border-left: 5px solid var(--plan-border-3);}
.plan-table { min-width: 700px; }
.plan-grid { display: flex; justify-content: space-between; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 8px; }
.day-card { min-width: 120px; flex-grow: 1; text-align: center; padding: 10px 5px; border-radius: 12px; border: 1px solid #E0E0E0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: #FFFFFF; }
.day-name { font-weight: 600; padding: 2px 0; margin-bottom: 4px; border-radius: 8px; color: #333; }
.day-name.mon { background-color: #FFECC6; border: 1px solid #FFC107; color: #333; }
.day-name.tue { background-color: #E6E1F4; border: 1px solid #673AB7; color: #333; }
.day-name.wed { background-color: #E6F7E6; border: 1px solid #4CAF50; color: #333; }
.day-name.thu { background-color: #FEEED7; border: 1px solid #FF9800; color: #333; }
.day-name.fri { background-color: #E1F1FD; border: 1px solid #2196F3; color: #333; }
.day-name.sat { background-color: #FDE8F1; border: 1px solid #E91E63; color: #333; }
.day-name.sun { background-color: #FCE6E6; border: 1px solid #F44336; color: #333; }
.daily-mg { font-size: 14px; color: #4CAF50; font-weight: 500; margin-bottom: 6px; }
.daily-dose-text { font-size: 12px; color: var(--muted); line-height: 1.4; margin-top: 4px; }
.pill-container { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; align-items: center; padding: 4px 0; min-height: 32px; }
.pill-icon-wrapper { position: relative; display: inline-block; flex-shrink: 1; --pill-size: 24px; }
.pill-icon { width: var(--pill-size); height: var(--pill-size); border-radius: 50%; display: inline-block; cursor: default; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s ease; }
.pill-icon-3mg { background-color: #4FC3F7; } /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
.pill-icon-2mg { background-color: #FFB74D; } /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
.half-pill { width: var(--pill-size); height: var(--pill-size); border-radius: 50%; clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%); }
.pill-container.shrink-pills .pill-icon-wrapper { --pill-size: 18px; gap: 2px; }
.pill-container.shrink-pills .pill-icon-wrapper .tooltip-text { font-size: 10px; }
.pill-icon-wrapper .tooltip-text { visibility: hidden; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 5px 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; transform: translateX(-50%); white-space: nowrap; opacity: 0; transition: opacity 0.2s; font-size: 12px; }
.pill-icon-wrapper:hover .tooltip-text { visibility: visible; opacity: 1; }
.pill-icon-wrapper .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent; }
.summary-pill { display: inline-block; width: 14px; height: 14px; border-radius: 50%; margin-right: 5px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
.summary-line { font-size: 14px; margin-top: 5px; }

/* --- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Warfarin ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏π‡∏ì‡∏ß‡∏±‡∏ô (‡πÉ‡∏´‡∏°‡πà) --- */
.standalone-calculator {
    max-width: 980px;
    margin: 20px auto 0;
    padding: 18px;
    background: var(--card);
    border-radius: 16px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    border-top: 4px solid var(--main-pink); 
}

.calculator-header-new {
    font-size: 20px;
    font-weight: 600;
    color: var(--main-pink);
    padding-bottom: 10px;
    border-bottom: 2px solid var(--light-pink);
    margin-bottom: 15px;
    text-align: center;
}

/* ‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Flexbox ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á 2mg, 3mg ‡πÅ‡∏•‡∏∞ Comparison */
.dosing-comparison-container {
    display: flex;
    gap: 12px;
}

/* ‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Warfarin 2mg ‡πÅ‡∏•‡∏∞ 3mg (‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô) */
.pill-dosing-container {
    display: flex;
    flex-direction: column; /* ‡∏à‡∏±‡∏î‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö */
    flex: 1 1 30%; /* ‡πÅ‡∏ö‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô 30% */
}

.dose-input-group {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 8px;
    flex-grow: 1; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏ö‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á column */
}

/* üåü ‡∏™‡πÑ‡∏ï‡∏•‡πå Warfarin 2 mg (‡πÇ‡∏ó‡∏ô‡∏™‡πâ‡∏°) */
#dose2mgContainer {
    background: #FFFBF8; /* ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡∏™‡πâ‡∏° */
    border: 1px solid #FFAD60;
}
#dose2mgContainer .pill-section-title {
    color: #FFAD60;
    border-bottom: 1px dashed #FFDDAA;
}

/* üåü ‡∏™‡πÑ‡∏ï‡∏•‡πå Warfarin 3 mg (‡πÇ‡∏ó‡∏ô‡∏ü‡πâ‡∏≤) */
#dose3mgContainer {
    background: #F8FFFF; /* ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡∏ü‡πâ‡∏≤ */
    border: 1px solid #40B2D6;
}
#dose3mgContainer .pill-section-title {
    color: #40B2D6;
    border-bottom: 1px dashed #A0D0E0;
}

.dose-input-row {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 8px;
    font-size: 13px; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
}

.dose-input-row label {
    flex-basis: auto;
    font-size: 13px;
    color: #333;
    margin: 0;
    display: block;
    white-space: nowrap;
}

.dose-input-row input[type="number"] {
    width: 45px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
    text-align: center;
    font-size: 13px;
    box-sizing: border-box;
    height: 30px;
}

.pill-section-title {
    font-weight: 600;
    margin-bottom: 5px;
    padding-bottom: 5px;
    text-align: center; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡πá‡∏Å */
}

.add-row-btn {
    background: var(--light-pink);
    color: var(--main-pink);
    border: 1px solid var(--main-pink);
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
    margin-top: 5px;
    font-size: 12px;
    width: 100%; /* ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏Å‡∏£‡∏≠‡∏ö */
}
.add-row-btn:hover { background: #FFDDEE; }

/* üåü ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤ (‡πÇ‡∏ó‡∏ô‡∏Ç‡∏≤‡∏ß) */
.comparison-section {
    flex: 1 1 40%; /* ‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 2mg/3mg */
    padding: 15px;
    border-radius: 8px;
    background: #FFFFFF; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß */
    border: 1px solid #cfd8dc; /* ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
}

.comparison-section h4 {
    margin-top: 0;
    color: #40B2D6;
    border-bottom: 1px dashed #A0D0E0;
    padding-bottom: 5px;
}

.comparison-output {
    margin-top: 15px;
    padding: 15px;
    border: 1px solid #cfd8dc;
    border-left: 5px solid var(--accent-green); 
    border-radius: 8px; 
    background: #F0FFF0;
}

.comparison-output p {
    margin: 5px 0;
    font-size: 16px;
    line-height: 1.5;
}

.comparison-output strong {
    color: var(--accent-green);
    font-weight: 700;
    font-size: 17px;
}

.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    justify-content: flex-end;
}

.action-buttons button {
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: background 0.2s;
}

.calculate-btn {
    background: var(--main-pink);
    color: white;
}
.calculate-btn:hover { background: #C2185B; }

.clear-btn {
    background: #ccc;
    color: #333;
}
.clear-btn:hover { background: #B0B0B0; }

@media(max-width:900px){
    /* ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    .dosing-comparison-container {
        flex-direction: column;
    }
    .pill-dosing-container {
        flex: 1 1 100%;
        gap: 12px;
    }
    .comparison-section {
        flex: 1 1 100%;
    }
    .dose-input-row {
        flex-wrap: wrap; 
        justify-content: space-between;
    }
    .dose-input-row label {
        width: auto;
    }
    .dose-input-row input[type="number"] {
        width: 60px;
    }
}
</style>
</head>
<body oncontextmenu="return false;">
<div class="container">
    
    <header class="card" style="align-items:center">
        <h1>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ Warfarin ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏û‡∏∏‡∏ô‡∏û‡∏¥‡∏ô</h1>
    </header>
    <section class="card">
        <form id="form">
            <div class="row">
                <div class="col">
                    <label>INR ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                    <input type="number" step="0.01" id="inr" min="0" value="2.5" required>
                </div>
                <div class="col">
                    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ Warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (mg)</label>
                    <input type="number" step="0.1" id="weeklyDose" min="0" required>
                </div>
                <div class="col">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î (‡∏ß‡∏±‡∏ô)</label>
                    <input type="number" id="days" min="1" value="7" required>
                </div>
            </div>
            <div style="margin-top:12px">
                <label>‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
                <div class="radio-row">
                    <label class="pill"><input type="radio" name="pills" value="3" checked> ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 3 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</label>
                    <label class="pill"><input type="radio" name="pills" value="2"> ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 2 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</label>
                    <label class="pill"><input type="radio" name="pills" value="both"> ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡πÅ‡∏•‡∏∞ 3 mg</label>
                    <label class="pill"><input type="radio" name="pills" value="3mg_fixed_1dayoff"> 3 mg‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ</label>
                    <label class="pill"><input type="radio" name="pills" value="2mg_fixed_1dayoff"> 2 mg‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ</label>
                </div>
            </div>
            <div style="margin-top:12px" class="row">
                <div class="col">
                    <label>‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å</label>
                    <div class="radio-row">
                        <label class="pill"><input type="radio" name="bleed" value="no" checked> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
                        <label class="pill"><input type="radio" name="bleed" value="yes"> ‡∏°‡∏µ</label>
                    </div>
                </div>
                <div class="col">
                    <label>‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</label>
                    <div class="radio-row">
                        <label class="pill"><input type="radio" name="displayMode" value="number" checked> ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</label>
                        <label class="pill"><input type="radio" name="displayMode" value="image"> ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤</label>
                    </div>
                </div>
            </div>
        </form>
        <div id="results" class="result" style="display:none"></div>
    </section>
    <section id="tables" class="card" style="display:none">
        <h3 style="color:var(--accent)">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ (7 ‡∏ß‡∏±‡∏ô)</h3>
        <div id="plans"></div>
        <div style="margin-top:12px;text-align:right">
            <button onclick="window.print()" class="primary">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î / ‡∏û‡∏¥‡∏°‡∏û‡πå (PDF)</button>
        </div>
    </section>
    
    <div class="standalone-calculator">
        <div class="calculator-header-new">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏≤‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì mg ‡∏£‡∏ß‡∏°‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏Ç‡∏≠‡∏á warfarin</div>
        
        <div class="dosing-comparison-container">
            
            <div class="pill-dosing-container">
                <div id="dose2mgContainer" class="dose-input-group">
                    <div class="pill-section-title">Warfarin **2** mg (‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡∏™‡πâ‡∏°)</div>
                    <div class="dose-input-row" data-mg="2">
                        <label>‡πÄ‡∏°‡πá‡∏î:</label>
                        <input type="number" step="0.5" min="0" value="" class="pill-count" oninput="calculateComparison(false)">
                        <label>√ó</label>
                        <input type="number" step="1" min="0" max="7" value="" class="day-count" oninput="calculateComparison(false)">
                        <label>‡∏ß‡∏±‡∏ô</label>
                    </div>
                    <button class="add-row-btn" onclick="addRow(2)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô/‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 2 mg</button>
                </div>
            </div>

            <div class="pill-dosing-container">
                <div id="dose3mgContainer" class="dose-input-group">
                    <div class="pill-section-title">Warfarin **3** mg (‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡∏ü‡πâ‡∏≤)</div>
                    <div class="dose-input-row" data-mg="3">
                        <label>‡πÄ‡∏°‡πá‡∏î:</label>
                        <input type="number" step="0.5" min="0" value="" class="pill-count" oninput="calculateComparison(false)">
                        <label>√ó</label>
                        <input type="number" step="1" min="0" max="7" value="" class="day-count" oninput="calculateComparison(false)">
                        <label>‡∏ß‡∏±‡∏ô</label>
                    </div>
                    <button class="add-row-btn" onclick="addRow(3)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô/‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 3 mg</button>
                </div>
            </div>

            <div class="comparison-section">
                <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö/‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î</h4>
                <div class="dose-input-row" style="margin-bottom: 10px;">
                    <label for="initialWeeklyDose" style="width: 150px; color: var(--main-pink);">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏° (mg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå):</label>
                    <input type="number" step="0.1" id="initialWeeklyDose" min="0" style="width: 70px;" oninput="calculateComparison(false)">
                </div>
                <div class="dose-input-row">
                    <label for="dispenseDays" style="width: 150px; color: var(--main-pink);">‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢ (‡∏ß‡∏±‡∏ô):</label>
                    <input type="number" id="dispenseDays" min="1" style="width: 70px;" oninput="calculateComparison(false)">
                </div>

                <div class="action-buttons">
                    <button class="clear-btn" onclick="clearData()">‡∏•‡πâ‡∏≤‡∏á</button>
                    <button class="calculate-btn" onclick="calculateComparison(true)">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
                </div>
            </div>

        </div> <div id="comparisonResult" class="comparison-output" style="display: none;">
            </div>
    </div>
    <footer class="card small">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡πÄ‡πÄ‡∏û‡∏ó‡∏¢‡πå/‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</footer>
</div>
<script>
// --- START: COPY PROTECTION CODE (‡πÄ‡∏î‡∏¥‡∏°) ---
document.onkeydown = function(e) {
    if (e.keyCode == 123 || 
        (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) ||
        (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) ||
        (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) ) {
        return false;
    }
};
// --- END: COPY PROTECTION CODE (‡πÄ‡∏î‡∏¥‡∏°) ---

// ******************************************************
// ** GLOBAL FUNCTIONS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å HTML: onclick/oninput) **
// ******************************************************

/**
 * ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
 * @param {number} num
 */
function roundTwoDecimals(num) { 
    return Math.round(num * 100) / 100;
}

/**
 * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô (Global)
 * @param {number} mg - 3 ‡∏´‡∏£‡∏∑‡∏≠ 2
 */
function addRow(mg) {
    const containerId = `dose${mg}mgContainer`;
    const container = document.getElementById(containerId);
    
    if (!container) return; 

    const newRow = document.createElement('div');
    newRow.className = 'dose-input-row';
    newRow.setAttribute('data-mg', mg);
    newRow.innerHTML = `
        <label>‡πÄ‡∏°‡πá‡∏î:</label>
        <input type="number" step="0.5" min="0" value="" class="pill-count" oninput="calculateComparison(false)">
        <label>√ó</label>
        <input type="number" step="1" min="0" max="7" value="" class="day-count" oninput="calculateComparison(false)">
        <label>‡∏ß‡∏±‡∏ô</label>
        <button onclick="removeRow(this)" style="background: none; border: none; color: #E91E63; cursor: pointer; font-weight: bold; font-size: 13px; padding: 0 5px;">[‡∏•‡∏ö]</button>
    `;

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß (lastElementChild)
    container.insertBefore(newRow, container.lastElementChild);
    calculateComparison(false);
}

/**
 * ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤ (Global)
 * @param {HTMLElement} btn - ‡∏õ‡∏∏‡πà‡∏° [‡∏•‡∏ö] ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏î
 */
function removeRow(btn) {
    const row = btn.parentNode;
    row.remove();
    calculateComparison(false);
}

/**
 * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏£‡∏ß‡∏° (Global)
 * @param {boolean} isManualClick - true ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'
 */
function calculateComparison(isManualClick) {
    const initialDoseInput = document.getElementById('initialWeeklyDose');
    const daysInput = document.getElementById('dispenseDays');
    const resultDiv = document.getElementById('comparisonResult');

    if (!initialDoseInput || !daysInput || !resultDiv) return;

    // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ 0 ‡πÅ‡∏•‡∏∞ 7 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
    const initialWeeklyDose = parseFloat(initialDoseInput.value) || 0;
    const dispenseDays = parseInt(daysInput.value) || 7; 
    
    let totalWeeklyMg = 0;
    let total3mgPillsFor7Days = 0;
    let total2mgPillsFor7Days = 0;

    const allDoseRows = document.querySelectorAll('.standalone-calculator .dose-input-row');
    
    allDoseRows.forEach(row => {
        const mg = parseInt(row.getAttribute('data-mg'));
        const pillCountInput = row.querySelector('.pill-count');
        const dayCountInput = row.querySelector('.day-count');
        
        if (!pillCountInput || !dayCountInput) return;
        
        // *** ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ parseFloat() || 0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á/null/NaN ‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á input ‡∏ß‡πà‡∏≤‡∏á ***
        const pillCount = parseFloat(pillCountInput.value) || 0;
        const dayCount = parseInt(dayCountInput.value) || 0;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô
        if (dayCount < 0 || dayCount > 7) {
            if (isManualClick) {
                 alert(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Warfarin ${mg} mg ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0 ‡∏ñ‡∏∂‡∏á 7`);
            }
            return; 
        }
        
        const weeklyMgFromRow = pillCount * mg * dayCount;
        totalWeeklyMg += weeklyMgFromRow;
        
        if (mg === 3) {
            total3mgPillsFor7Days += pillCount * dayCount;
        } else if (mg === 2) {
            total2mgPillsFor7Days += pillCount * dayCount;
        }
    });
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡πÜ ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Warfarin
    if (totalWeeklyMg === 0 && !isManualClick) {
         // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const allEmpty = Array.from(allDoseRows).every(row => {
            const pillCountInput = row.querySelector('.pill-count');
            const dayCountInput = row.querySelector('.day-count');
            return (!pillCountInput.value || pillCountInput.value.trim() === '0') && 
                   (!dayCountInput.value || dayCountInput.value.trim() === '0');
        });
        
        if(allEmpty) {
            resultDiv.style.display = 'none';
            return;
        }
    }
    
    totalWeeklyMg = roundTwoDecimals(totalWeeklyMg);
    const dailyMg = roundTwoDecimals(totalWeeklyMg / 7);
    
    const diffMg = roundTwoDecimals(totalWeeklyMg - initialWeeklyDose);
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á
    const diffPct = initialWeeklyDose === 0 ? 
        (totalWeeklyMg === 0 ? 0 : 100) : // ‡∏ñ‡πâ‡∏≤ dose ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÅ‡∏•‡∏∞ dose ‡πÉ‡∏´‡∏°‡πà > 0 ‡∏Ñ‡∏∑‡∏≠ +100% (‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ 0 ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ)
        roundTwoDecimals((diffMg / initialWeeklyDose) * 100);
    
    if(dispenseDays <= 0 && isManualClick) {
        alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ö‡∏ß‡∏Å');
    }

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î (‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô) (‡πÉ‡∏ä‡πâ dispenseDays = 7 ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤)
    const final3mgPills = Math.ceil(total3mgPillsFor7Days * (dispenseDays / 7));
    const final2mgPills = Math.ceil(total2mgPillsFor7Days * (dispenseDays / 7));

    let resultHTML = `
        <p>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (7 ‡∏ß‡∏±‡∏ô): <strong>${totalWeeklyMg.toFixed(2)} mg</strong> (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${dailyMg.toFixed(2)} mg/‡∏ß‡∏±‡∏ô)</p>
        <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏° (${initialWeeklyDose.toFixed(2)} mg): <strong style="color: ${diffMg >= 0 ? 'red' : 'green'};">${diffMg >= 0 ? '+' : ''}${diffMg.toFixed(2)} mg (${diffPct >= 0 ? '+' : ''}${diffPct.toFixed(2)}%)</strong></p>
        <hr style="border-top: 1px solid #ccc; margin: 10px 0;">
        <p>‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <strong>${dispenseDays} ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î</strong>:</p>
        <p>Warfarin 3 mg: <strong>${final3mgPills} ‡πÄ‡∏°‡πá‡∏î</strong></p>
        <p>Warfarin 2 mg: <strong>${final2mgPills} ‡πÄ‡∏°‡πá‡∏î</strong></p>
    `;
    
    resultDiv.innerHTML = resultHTML;
    resultDiv.style.display = 'block';
}

/**
 * ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏π‡∏ì‡∏ß‡∏±‡∏ô (Global)
 */
function clearData() {
    const initialDoseInput = document.getElementById('initialWeeklyDose');
    const daysInput = document.getElementById('dispenseDays');
    const resultDiv = document.getElementById('comparisonResult');

    if (!initialDoseInput || !daysInput || !resultDiv) return;

    document.querySelectorAll('.standalone-calculator .dose-input-group').forEach(container => {
        // ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 ‡∏´‡∏£‡∏∑‡∏≠ index 1)
        const rows = container.querySelectorAll('.dose-input-row');
        for (let i = 1; i < rows.length; i++) {
            rows[i].remove();
        }
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏ñ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const pillCountInput = rows[0].querySelector('.pill-count');
        const dayCountInput = rows[0].querySelector('.day-count');
        if (pillCountInput) pillCountInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        if (dayCountInput) dayCountInput.value = '';  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    });

    initialDoseInput.value = '';
    daysInput.value = '';
    resultDiv.style.display = 'none';
    resultDiv.innerHTML = '';
}


// ******************************************************
// ** DOM CONTENT LOADED (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Event Listeners ‡πÅ‡∏•‡∏∞ Funtions ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô) **
// ******************************************************

document.addEventListener('DOMContentLoaded', function() {
    
    // --- FUNTIONS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢ Event Listeners (Local) ---
    function roundHalf(x){return Math.round(x*2)/2}
    function distributeEvenly7(total){
        const base = Math.floor(total/7);
        let arr = Array(7).fill(base);
        let rem = total - base*7;
        for(let i=0;i<rem;i++) arr[i]++;
        return arr;
    }
    
    /**
     * **‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà:** ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏¢‡∏≤ 7 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏ö‡∏ö‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á) ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏ß‡∏±‡∏ô (0 mg)
     * @param {number} totalPills - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏° 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ
     */
    function distributeEvenly7Fixed(totalPills) {
        if (totalPills === 0) return Array(7).fill(0);
        
        let daysToDose = 7;
        let arr = [];

        // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏™‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 7 ‡πÄ‡∏°‡πá‡∏î)
        if (totalPills < 7) {
            daysToDose = 6; // ‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤‡πÅ‡∏Ñ‡πà 6 ‡∏ß‡∏±‡∏ô ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 0 mg
        }
        
        const basePills = Math.floor(totalPills / daysToDose);
        arr = Array(daysToDose).fill(basePills);
        let remainingPills = totalPills - basePills * daysToDose;
        
        for (let i = 0; i < remainingPills; i++) arr[i]++;

        // ‡∏ñ‡πâ‡∏≤‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏Ñ‡πà 6 ‡∏ß‡∏±‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° 0 mg ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ 1 ‡∏ß‡∏±‡∏ô
        if (daysToDose === 6) {
            arr.push(0); 
        }

        // ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô arr ‡πÄ‡∏õ‡πá‡∏ô Integer (‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°)
        return arr.map(p => Math.round(p)); 
    }
    
    function findBestCombo(target){
        const numSets = Math.round(target / 5);
        const h3 = numSets;
        const h2 = numSets;
        const total = h3*3 + h2*2;
        return {h3:h3, h2:h2, total:total, type:'5mg'};
    }
    function generatePillImage(count, pillMg){
        let html = '';
        const fullPills = Math.floor(count);
        const hasHalf = count % 1 !== 0;
        const pillClass = pillMg === 3 ? 'pill-icon-3mg' : 'pill-icon-2mg';
        const pillText = `${pillMg} mg`;
        for(let i=0; i<fullPills; i++){
            html += `<div class="pill-icon-wrapper">
                        <span class="pill-icon ${pillClass}"></span>
                        <span class="tooltip-text">${pillText} (‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏°‡πá‡∏î)</span>
                    </div>`;
        }
        if(hasHalf){
            html += `<div class="pill-icon-wrapper">
                        <span class="pill-icon half-pill ${pillClass}"></span>
                        <span class="tooltip-text">${pillText} (‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î)</span>
                    </div>`;
        }
        return html; 
    }
    function buildPlanHTML(title, combo, weeklyDose, displayMode, total3PillCount, total2PillCount, planIndex){
        const pillChoice = document.querySelector('input[name="pills"]:checked').value; 
        const isFixedDose = pillChoice === '3mg_fixed_1dayoff' || pillChoice === '2mg_fixed_1dayoff';

        let perDay3 = [];
        let perDay2 = [];

        // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏°‡πá‡∏î
        if (isFixedDose) {
            if (pillChoice === '3mg_fixed_1dayoff') {
                perDay3 = distributeEvenly7Fixed(combo.h3); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î 3mg (‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°)
                perDay2 = Array(7).fill(0);
            } else if (pillChoice === '2mg_fixed_1dayoff') {
                perDay2 = distributeEvenly7Fixed(combo.h2); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î 2mg (‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°)
                perDay3 = Array(7).fill(0);
            }
        } else {
            // ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÄ‡∏î‡∏¥‡∏° (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î)
            perDay3 = distributeEvenly7(combo.h3);
            perDay2 = distributeEvenly7(combo.h2);
        }

        const totalWeekly = combo.total;
        const diffWeekPct = weeklyDose===0?0:((totalWeekly-weeklyDose)/weeklyDose)*100;
        const pctText = `${diffWeekPct>0?'+':''}${diffWeekPct.toFixed(2)}%`;
        const dayNames = ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™','‡∏®‡∏∏‡∏Å‡∏£‡πå','‡πÄ‡∏™‡∏≤‡∏£‡πå','‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'];
        const dayClasses = ['mon','tue','wed','thu','fri','sat','sun']; 
        
        let html = `<div class="plan-section plan-${planIndex}">`;
        html += `<h4>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${title} ‚Äî ‡∏£‡∏ß‡∏° ${totalWeekly.toFixed(2)} mg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (${pctText} ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°)</h4>`;
        if (displayMode === 'image') {
            html += `<div class="plan-grid">`;
            for(let i=0;i<7;i++){
                let t3 = perDay3[i]; // ‡πÄ‡∏°‡πá‡∏î 3mg
                let t2 = perDay2[i]; // ‡πÄ‡∏°‡πá‡∏î 2mg

                if (!isFixedDose) {
                    if (combo.type === '3mg') { 
                        t3 = t3 / 2; // t3 ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î
                        t2 = 0;
                    } else if (combo.type === '2mg') { 
                        t2 = t2 / 2; // t2 ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î
                        t3 = 0;
                    }
                }
                
                const mg = t3*3 + t2*2;
                const t3Html = generatePillImage(t3, 3);
                const t2Html = generatePillImage(t2, 2);
                const totalPillUnits = Math.ceil(t3) + Math.ceil(t2);
                const shrinkClass = totalPillUnits >= 5 ? 'shrink-pills' : '';
                let doseText = '';
                if (t3 > 0) doseText += `3 mg x ${t3 % 1 === 0 ? t3 : t3.toFixed(1)}\n`;
                if (t2 > 0) doseText += `2 mg x ${t2 % 1 === 0 ? t2 : t2.toFixed(1)}`;
                html += `
                    <div class="day-card">
                        <div class="day-name ${dayClasses[i]}">${dayNames[i]}</div>
                        <div class="daily-mg">(${mg.toFixed(1)} mg)</div>
                        <div class="pill-container ${shrinkClass}">${t2Html}${t3Html}</div>
                        <div class="daily-dose-text" style="white-space:pre-line">${doseText.trim()}</div>
                    </div>
                `;
            }
            html += `</div>`;
            html += `<h4>‡∏£‡∏ß‡∏°‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${document.getElementById('days').value} ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î:</h4>`;
            html += `<div class="summary">`;
            if(total3PillCount > 0) {
                html += `<div class="summary-line"><span class="summary-pill pill-icon-3mg"></span> 3 mg: ${total3PillCount} ‡πÄ‡∏°‡πá‡∏î</div>`;
            }
            if(total2PillCount > 0) {
                html += `<div class="summary-line"><span class="summary-pill pill-icon-2mg"></span> 2 mg: ${total2PillCount} ‡πÄ‡∏°‡πá‡∏î</div>`;
            }
            html += `</div>`;
        } else {
            const pillTypes = [];
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà
            if (pillChoice === '3' || pillChoice === 'both' || pillChoice === '3mg_fixed_1dayoff') pillTypes.push({ label: '3 mg (‡πÄ‡∏°‡πá‡∏î)', type: 3 });
            if (pillChoice === '2' || pillChoice === 'both' || pillChoice === '2mg_fixed_1dayoff') pillTypes.push({ label: '2 mg (‡πÄ‡∏°‡πá‡∏î)', type: 2 });
            pillTypes.push({ label: '‡∏£‡∏ß‡∏° (mg)', type: 'total' });
            
            let headerCols = `<th>‡∏ä‡∏ô‡∏¥‡∏î‡∏¢‡∏≤</th>`;
            dayNames.forEach(day => { headerCols += `<th>${day}</th>`; });
            html += `<table class="plan-table plan-${planIndex}"><thead><tr>${headerCols}</tr></thead><tbody>`;
            
            pillTypes.forEach(pillType => {
                let dataRow = `<tr><td style="font-weight: 600;">${pillType.label}</td>`;
                for(let i=0;i<7;i++){
                    let t3 = perDay3[i];
                    let t2 = perDay2[i];
                    
                    if (!isFixedDose) {
                        if (combo.type === '3mg') { 
                            t3 = t3 / 2; // t3 ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î
                            t2 = 0;
                        } else if (combo.type === '2mg') { 
                            t2 = t2 / 2; // t2 ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î
                            t3 = 0;
                        }
                    }

                    const mg = t3*3 + t2*2;
                    let value = '';
                    if (pillType.type === 3) {
                        // FIX: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ '‡∏´‡∏¢‡∏∏‡∏î'
                        if (isFixedDose && t3 === 0) {
                            value = '<span style="color: var(--main-pink); font-weight: 700;">‡∏´‡∏¢‡∏∏‡∏î</span>';
                        } else {
                            value = t3 % 1 === 0 ? t3 : t3.toFixed(1);
                        }
                    } else if (pillType.type === 2) {
                        // FIX: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ '‡∏´‡∏¢‡∏∏‡∏î'
                        if (isFixedDose && t2 === 0) {
                            value = '<span style="color: var(--main-pink); font-weight: 700;">‡∏´‡∏¢‡∏∏‡∏î</span>';
                        } else {
                            value = t2 % 1 === 0 ? t2 : t2.toFixed(1);
                        }
                    } else if (pillType.type === 'total') {
                        value = mg.toFixed(2);
                    }
                    dataRow += `<td>${value}</td>`;
                }
                dataRow += `</tr>`;
                html += dataRow;
            });
            html += `</tbody></table>`;
            let noteText = `‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤ (${document.getElementById('days').value} ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î)\n`;
            if(total3PillCount > 0 && (pillChoice === '3' || pillChoice === 'both' || pillChoice === '3mg_fixed_1dayoff')) noteText += `‡∏£‡∏ß‡∏° 3 mg: ${total3PillCount} ‡πÄ‡∏°‡πá‡∏î\n`;
            if(total2PillCount > 0 && (pillChoice === '2' || pillChoice === 'both' || pillChoice === '2mg_fixed_1dayoff')) noteText += `‡∏£‡∏ß‡∏° 2 mg: ${total2PillCount} ‡πÄ‡∏°‡πá‡∏î`;
            if(noteText.trim()) html += `<div class="note" style="white-space:pre-line">${noteText}</div>`;
        }
        html += `</div>`;
        return html;
    }

    // **‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô calculate() ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
    function calculate(){
        const inrInput = document.getElementById('inr');
        const weeklyDoseInput = document.getElementById('weeklyDose');
        const daysInput = document.getElementById('days');
        const resDiv = document.getElementById('results');
        const tables = document.getElementById('tables');
        const plansDiv = document.getElementById('plans');
        
        if (!inrInput || !weeklyDoseInput || !daysInput) return;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (inrInput.value.trim() === '' || weeklyDoseInput.value.trim() === '' || daysInput.value.trim() === '') {
            resDiv.style.display = 'none';
            tables.style.display = 'none';
            plansDiv.innerHTML = '';
            return; 
        }

        const inr = parseFloat(inrInput.value);
        const weeklyDose = parseFloat(weeklyDoseInput.value);
        const pillChoice = document.querySelector('input[name="pills"]:checked').value;
        const bleed = document.querySelector('input[name="bleed"]:checked').value;
        const displayMode = document.querySelector('input[name="displayMode"]:checked').value; 
        
        if(isNaN(inr)||isNaN(weeklyDose)) return; 
        
        if(bleed==='yes'){
           resDiv.innerHTML = `<div class="card"><p><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏û‡∏ö‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å: ‡πÉ‡∏´‡πâ Vit K1 ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</p></div>`;
           resDiv.style.display='block';
           tables.style.display='none';
           plansDiv.innerHTML='';
           return;
        }
        
        let adj = {minPct:0,maxPct:0,avgPct:0,note:''};
        if(inr < 1.5){adj.minPct=0.10;adj.maxPct=0.20;adj.avgPct=0.15;adj.note='‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 10‚Äì20%';}
        else if(inr>=1.5 && inr<=1.9){adj.minPct=0.05;adj.maxPct=0.10;adj.avgPct=0.075;adj.note='‡πÄ‡∏û‡∏¥‡πà‡∏° 5‚Äì10% ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° INR ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô';}
        else if(inr>=2.0 && inr<=3.0){adj.minPct=0;adj.maxPct=0;adj.avgPct=0;adj.note='‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤';}
        else if(inr>=3.1 && inr<=3.9){adj.minPct=-0.10;adj.maxPct=-0.05;adj.avgPct=-0.075;adj.note='‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 5‚Äì10%';}
        else if(inr>3.9 && inr<5.0){adj.minPct=-0.10;adj.maxPct=-0.10;adj.avgPct=-0.10;adj.note='‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ 1 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏•‡∏á 10%';}
        else if(inr>=5.0 && inr<9.0){adj.minPct=-0.20;adj.maxPct=-0.20;adj.avgPct=-0.20;adj.note='‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ 2 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏•‡∏á 20% ‚Äî ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏´‡πâ Vitamin K‚ÇÅ';}
        else if(inr>=9.0){adj.minPct=null;adj.maxPct=null;adj.avgPct=null;adj.note='INR > 9.0: ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ ‡πÉ‡∏´‡πâ Vitamin K‚ÇÅ 2.5‚Äì5 mg ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° INR ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î';}
        
        let newRange = {};
        if(adj.minPct===null){
           newRange.note = '‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö INR >= 9.0 ‚Äî ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô';
        } else{
           const min = weeklyDose*(1+adj.minPct);
           const max = weeklyDose*(1+adj.maxPct);
           const avg = weeklyDose*(1+adj.avgPct);
           
           let minRound, maxRound, avgRound;

           if (pillChoice === '3mg_fixed_1dayoff') {
               // ‡πÇ‡∏î‡∏™‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì‡∏Ç‡∏≠‡∏á 3 (‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° 3mg)
               minRound = Math.round(min / 3) * 3;
               maxRound = Math.round(max / 3) * 3;
               avgRound = Math.round(avg / 3) * 3;
           } else if (pillChoice === '2mg_fixed_1dayoff') {
               // ‡πÇ‡∏î‡∏™‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì‡∏Ç‡∏≠‡∏á 2 (‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° 2mg)
               minRound = Math.round(min / 2) * 2;
               maxRound = Math.round(max / 2) * 2;
               avgRound = Math.round(avg / 2) * 2;
           } else {
               // ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÄ‡∏î‡∏¥‡∏° (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î)
               minRound = roundHalf(min);
               maxRound = roundHalf(max);
               avgRound = roundHalf(avg);
           }
           
           newRange = {
             minCalc: parseFloat(min.toFixed(2)),
             maxCalc: parseFloat(max.toFixed(2)),
             avgCalc: parseFloat(avg.toFixed(2)),
             min: minRound,
             max: maxRound,
             avg: avgRound
           };
        }
        
        let html = `<div class="card"><p><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> INR = ${inr.toFixed(2)} ‚Äî ${adj.note}</p>`;
        if(newRange.note) html += `<p class="note">${newRange.note}</p>`;
        else html += `<p>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (mg) : <strong>${newRange.minCalc.toFixed(2)} ‚Äî ${newRange.maxCalc.toFixed(2)}</strong> (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${newRange.avgCalc.toFixed(2)} mg)</p>`;
        html += `</div>`;
        resDiv.innerHTML = html;
        resDiv.style.display='block';
        plansDiv.innerHTML='';
        
        if(newRange.min!==undefined){
           const targets = [
              {k:'‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î', val:newRange.min, pct:adj.minPct},
              {k:'‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', val:newRange.avg, pct:adj.avgPct},
              {k:'‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î', val:newRange.max, pct:adj.maxPct}
           ];
           const numDays = parseInt(daysInput.value);
            
           targets.forEach((t, index)=>{
            let best;
            let isFixedDose = false;
            
            if (pillChoice === '3mg_fixed_1dayoff') {
                const numPills = Math.round(t.val / 3); 
                best = { h3: numPills, h2: 0, total: numPills * 3, type: '3mg_fixed' };
                isFixedDose = true;
            } else if (pillChoice === '2mg_fixed_1dayoff') {
                const numPills = Math.round(t.val / 2); 
                best = { h3: 0, h2: numPills, total: numPills * 2, type: '2mg_fixed' };
                isFixedDose = true;
            }
            // ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÄ‡∏î‡∏¥‡∏°
            else if(pillChoice==='3'){
              const h3=Math.round(t.val/1.5); 
              best={h3:h3,h2:0,total:h3*1.5,type:'3mg'}; 
            } else if(pillChoice==='2'){
              const h2=Math.round(t.val/1.0); 
              best={h3:0,h2:h2,total:h2*1.0,type:'2mg'}; 
            } else {
              best=findBestCombo(t.val);
              best.type='5mg';
            }
            
            let total3 = 0, total2 = 0;
            let perDay3 = [];
            let perDay2 = [];
            
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏°‡πá‡∏î
            if (isFixedDose) {
                if (pillChoice === '3mg_fixed_1dayoff') {
                    perDay3 = distributeEvenly7Fixed(best.h3); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î 3mg
                    perDay2 = Array(7).fill(0);
                } else if (pillChoice === '2mg_fixed_1dayoff') {
                    perDay2 = distributeEvenly7Fixed(best.h2); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î 2mg
                    perDay3 = Array(7).fill(0);
                }
            } else {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏î‡∏¥‡∏° (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î)
                perDay3 = distributeEvenly7(best.h3);
                perDay2 = distributeEvenly7(best.h2);
            }

            for(let i=0; i<numDays; i++){
                if(isFixedDose) {
                    // ‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°
                    total3 += perDay3[i % 7];
                    total2 += perDay2[i % 7];
                } else if(best.type==='3mg'){
                    total3 += perDay3[i % 7]/2; // perDay3 ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î
                } else if(best.type==='2mg'){
                    total2 += perDay2[i % 7]/2; // perDay2 ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î
                } else if(best.type==='5mg'){
                    total3 += perDay3[i % 7]; // perDay3 ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° 3mg
                    total2 += perDay2[i % 7]; // perDay2 ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° 2mg
                }
            }
              
              total3 = Math.ceil(total3);
              total2 = Math.ceil(total2);

            let planHTML = buildPlanHTML(t.k, best, weeklyDose, document.querySelector('input[name="displayMode"]:checked').value, total3, total2, index + 1);
            
              plansDiv.innerHTML += planHTML;
           });
           tables.style.display='block';
        } else {
           plansDiv.innerHTML=`<div class="note">${newRange.note}</div>`;
           tables.style.display='block';
        }
    }


    // --- EVENT LISTENERS (‡πÄ‡∏î‡∏¥‡∏°) ---
    document.querySelectorAll('input[name="displayMode"]').forEach(el=>el.addEventListener('change',calculate));
    document.querySelectorAll('input[name="pills"]').forEach(el=>el.addEventListener('change',calculate));
    document.querySelectorAll('input[name="bleed"]').forEach(el=>el.addEventListener('change',calculate));
    document.getElementById('inr').addEventListener('input',calculate);
    document.getElementById('weeklyDose').addEventListener('input',calculate);
    document.getElementById('days').addEventListener('input',calculate);

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ calculate() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    calculate(); 
});
</script>
</body>
</html>
